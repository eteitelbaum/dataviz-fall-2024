{
  "hash": "fc067113903cd76d7d9b0312aee8cfb0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Merging and Summarizing Data\ndate: today\ndate-format: long\nfooter: \"[DataViz 2102 Website](https://dataviz-gwu.rocks)\"\nlogo: images/dataviz-logo.png\nformat:\n  revealjs:\n    theme: [simple, custom.scss]\n    transition: fade\n    slide-number: true\n    multiplex: true\n    chalkboard: true\nexecute:\n  echo: true\n  message: false\n  warning: false\n  freeze: auto\n---\n\n\n## Merging Data Frames\n\n- Often we have data from two different sources\n- Results in two data frames\n- How to make them one so we can analyze? \n- Key questions\n  - What is the unit of analysis? \n  - What is/are the corresponding identifier variables?\n  - Are the identifier variables in common? \n  - Or do they have to be added/transformed to match?\n  \n## Merging WB and V-Dem Data\n\n<br>\n\n- These are both time-series, country-level data\n- Need to merge by country-year\n- Year is easy\n- But there are many different country codes\n- Can use `countrycode` package to assign country codes\n\n## `countrycode` Example\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load countrycode\nlibrary(countrycode)\n\n# Create new iso3c variable\ndem_data <- dem_data |>    \n  mutate(iso3c = countrycode(sourcevar = country_id, # what we are converting\n        origin = \"vdem\",         # we are converting from vdem\n        destination = \"wb\"))  |> # and converting to the WB iso3c code \n  relocate(iso3c, .after = country_id) # move iso3c \n\n# View the data\nglimpse(dem_data)\n```\n:::\n\n\n## Try it Yourself\n\n<br>\n\n- Using your democracy data frame from the last lesson\n- Use `mutate()` and `countrycode()` to add iso3c country codes\n- Use `relocate` to move your iso3c code to the \"front\" of your data frame (optional)\n\n## Types of Joins in `dplyr`\n\n<br>\n\n- Mutating versus filtering joins\n- Four types of mutating joins\n  - `inner_join()`\n  - `full_join()`\n  - `left_join()`\n  - `right_join()`\n- For the most part we will use `left_join()`\n\n## `left_join()` Example\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform left join using common iso3c variable and year\ndem_women <- left_join(dem_data, women_emp, by = c(\"iso3c\", \"year\")) |> \n  select(-c(country_text_id, country_id, country)) |> # drop extra country codes/names\n  rename(region = e_regionpol_6C, \n         polyarchy = v2x_polyarchy,\n         libdem = v2x_libdem) |>\n    mutate(\n    region = case_match(region, # replace the values in region with country names\n                     1 ~ \"Eastern Europe\", \n                     2 ~ \"Latin America\",  \n                     3 ~ \"Middle East\",   \n                     4 ~ \"Africa\", \n                     5 ~ \"The West\", \n                     6 ~ \"Asia\")\n    )\n  \n# View the data\nglimpse(dem_women)  \n```\n:::\n\n\n## Try it Yourself\n\n<br>\n\n- Take your V-Dem data frame and your World Bank data frame\n- Using `left_join()` to merge on country code and year\n- Along the way, use `rename()` and `select()` to insure you have just one country name\n\n## Group, Summarize and Arrange\n\n<br>\n\n- `group_by()`, `summarize()`, `arrange()`\n- A very common sequence in data science:\n  - Take an average or some other statistic for a group\n  - Rank from high to low values of summary value\n  \n## Example\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# group_by(), summarize() and arrange()\ndem_women |> # save result as new object\n  group_by(region)  |> # group data by region\n  summarize(           # summarize following vars (by region)\n    polyarchy_mean = mean(polyarchy, na.rm = TRUE), # calculate mean after remove NAs\n    libdem_median = median(libdem, na.rm = TRUE), # calculate median after remove NAs\n    women_rep_sd = sd(women_rep, na.rm = TRUE), # calculate std. dev after remove NAs\n    flfp_min = min(flfp, na.rm = TRUE) # calculate minimum flfp after remove NAs\n  ) |> \n  arrange(desc(polyarchy_mean)) # arrange in descending order by polyarchy score\n```\n:::\n\n\n## \n\nUse `across()` to Apply Same Function to Multiple Columns\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndem_women |>\n  group_by(region) |> \n  summarize(\n    across(c(polyarchy, libdem, women_rep, flfp), mean, na.rm = TRUE)\n  ) |> \n  arrange(desc(polyarchy))\n```\n:::\n\n\n\n## Try it Yourself {.scrollable}\n\n- Try changing the parameters in the code to answer these questions: \n\n1. Try summarizing the data with a [different function](https://dplyr.tidyverse.org/reference/summarise.html#useful-functions) for one or more of the variables. \n  a. What is the median value of `polyarchy` for The West? \n  b. What is the max value of `libdem` for Eastern Europe?\n  c. What is the standard deviation of `women_rep` for Africa?\n  d. What is the mean of `flfp` for the Middle East?\n  \n2. Now try grouping by country instead of region and filter for years >= 2000.\n\n  a. What is the median value of `polyarchy` for Sweden? \n  b. What is the max value of `libdem` New Zealand?\n  c. What is the standard deviation of `women_rep` for Norway?\n  d. What is the min of `flfp` for Germany?\n\n3. Try sorting countries in ascending order of the selected variable (hint: delete \"desc\" from the `arrange()` call). Which country ranks at the \"top\" of the list? **Now change it back to descending order.** \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}